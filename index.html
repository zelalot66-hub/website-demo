<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Coyal.lol</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700&display=swap" rel="stylesheet">
  <style>
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      background: #111;
      color: #fff;
      font-family: 'Montserrat', sans-serif;
      overflow: hidden;
      user-select: none;
    }
    body {
      background: transparent;
      transition: background 1s cubic-bezier(.77,0,.18,1);
      text-transform: lowercase;
    }
    #wallpaper {
      position: fixed;
      top: 0; left: 0; width: 100vw; height: 100vh;
      object-fit: cover;
      z-index: 0;
      filter: grayscale(1) brightness(0.5);
      transition: filter 1s cubic-bezier(.77,0,.18,1);
      pointer-events: none;
    }
    .desktop {
      position: relative;
      width: 100vw;
      height: 100vh;
      z-index: 1;
    }
    #icons {
      position: absolute;
      top: 32px;
      left: 32px;
      display: flex;
      flex-direction: column;
      gap: 32px;
      z-index: 2;
    }
    .icon {
      width: 72px;
      display: flex;
      flex-direction: column;
      align-items: center;
      cursor: pointer;
      opacity: 0.92;
      transition: transform 0.2s cubic-bezier(.77,0,.18,1), box-shadow 0.2s;
      border-radius: 16px;
      padding: 8px 0 4px 0;
      background: rgba(30,30,30,0.2);
      box-shadow: 0 2px 12px 0 rgba(0,0,0,0.12);
      backdrop-filter: blur(2px);
      animation: iconIn 0.7s cubic-bezier(.77,0,.18,1);
    }
    .icon:hover {
      transform: scale(1.08) translateY(-4px);
      box-shadow: 0 6px 24px 0 rgba(0,0,0,0.22);
      background: rgba(255,255,255,0.05);
      opacity: 1;
    }
    .icon img {
      width: 48px;
      height: 48px;
      filter: grayscale(1) contrast(1.2);
      border-radius: 12px;
      margin-bottom: 4px;
      transition: filter 0.3s;
    }
    .icon span {
      font-size: 13px;
      color: #fff;
      text-shadow: 0 1px 2px #000;
      letter-spacing: 0.02em;
      font-weight: 700;
      text-align: center;
      margin-top: 2px;
      text-overflow: ellipsis;
      overflow: hidden;
      white-space: nowrap;
      width: 100%;
    }
    @keyframes iconIn {
      0% { opacity: 0; transform: scale(0.7) translateY(30px);}
      100% { opacity: 1; transform: scale(1) translateY(0);}
    }
    #icon-template { display: none; }
    .tasks { display: flex; align-items: center; gap: 10px; }
    .task-icon {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 10px;
      border-radius: 10px;
      background: rgba(255,255,255,0.08);
      border: 1px solid rgba(255,255,255,0.12);
      color: #fff;
      box-shadow: 0 2px 10px rgba(0,0,0,0.25);
      opacity: 0;
      transform: scale(0.9);
      transition: opacity .2s cubic-bezier(.77,0,.18,1), transform .2s cubic-bezier(.77,0,.18,1);
      cursor: pointer;
    }
    .task-icon.visible { opacity: 1; transform: scale(1); }
    .window {
      position: fixed;
      width: min(600px, calc(100vw - 16px));
      max-height: calc(100vh - 120px);
      background: rgba(20,20,20,0.35);
      border-radius: 14px;
      box-shadow: 0 8px 32px 0 rgba(0,0,0,0.35);
      z-index: 18;
      border: 1.5px solid rgba(255,255,255,0.08);
      -webkit-backdrop-filter: blur(10px) saturate(120%);
      backdrop-filter: blur(10px) saturate(120%);
      display: none;
      overflow: hidden;
      opacity: 0;
      transform: scale(0.96) translateY(8px);
      transition: opacity .18s cubic-bezier(.22,.61,.36,1), transform .18s cubic-bezier(.22,.61,.36,1);
      will-change: transform, opacity;
    }
    
    #terminal-window {
      width: min(800px, calc(100vw - 16px));
    }
    .window.visible { opacity: 1; transform: scale(1) translateY(0); }
    .window-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 4px 8px;
      font-weight: 700;
      letter-spacing: 0.03em;
      user-select: none;
      cursor: move;
    }
    .window-body {
      padding: 16px;
      box-sizing: border-box;
    }
    .close-btn {
      background: none;
      border: none;
      color: #fff;
      font-size: 14px;
      width: 24px;
      height: 24px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      border-radius: 6px;
      cursor: pointer;
    }
    .close-btn:hover { background: rgba(255,255,255,0.08); }
    #notepad-text {
      width: 100%;
      height: 380px;
      background: rgba(17,17,17,0.35);
      color: #fff;
      border: 1px solid rgba(255,255,255,0.12);
      border-radius: 8px;
      outline: none;
      padding: 10px;
      font-family: monospace;
      font-size: 14px;
      resize: none;
      box-sizing: border-box;
    }
    .terminal-body { display: flex; flex-direction: column; height: 380px; }
    #terminal-output {
      flex: 1;
      overflow-y: auto;
      background: transparent;
      border: 1px solid rgba(255,255,255,0.12);
      border-radius: 8px;
      padding: 10px;
      font-family: monospace;
      font-size: 14px;
      margin-bottom: 10px;
    }
    #terminal-input {
      background: rgba(17,17,17,0.35);
      color: #fff;
      border: 1px solid rgba(255,255,255,0.12);
      border-radius: 8px;
      padding: 10px;
      outline: none;
      font-family: monospace;
      font-size: 14px;
    }
    #terminal-window { background: rgba(15,15,15,0.3); }

    #music-window {
      background: rgba(15,15,15,0.3);
    }
    #music-window .window-body {
      padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 16px;
    }
    #music-title {
      font-size: 18px;
      font-weight: 700;
      color: #fff;
      letter-spacing: 0.04em;
      text-align: center;
      text-shadow: 0 2px 8px #000;
      min-height: 24px;
      transition: color 0.3s;
      margin-bottom: 8px;
    }
    #music-controls {
      display: flex;
      gap: 20px;
      align-items: center;
    }
    #music-controls button {
      background: none;
      border: none;
      color: #fff;
      font-size: 24px;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.2s, color 0.2s, transform 0.2s;
      cursor: pointer;
      outline: none;
    }
    #music-controls button:hover {
      background: rgba(255,255,255,0.08);
      transform: scale(1.1);
    }
    #volume-container {
      position: relative;
      display: flex;
      align-items: center;
    }
    #volume-btn {
      background: none;
      border: none;
      color: #fff;
      font-size: 24px;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.2s, transform 0.2s;
      cursor: pointer;
      outline: none;
      filter: grayscale(1);
    }
    #volume-btn:hover {
      background: rgba(255,255,255,0.08);
    }
    #volume-slider {
      position: absolute;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%);
      width: 120px;
      height: 8px;
      background: rgba(20,20,20,0.95);
      border-radius: 4px;
      border: 1px solid rgba(255,255,255,0.1);
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.2s, visibility 0.2s;
      margin-bottom: 8px;
      cursor: pointer;
    }
    #volume-container:hover #volume-slider {
      opacity: 1;
      visibility: visible;
    }
    #volume-slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 16px;
      height: 16px;
      border-radius: 50%;
      background: #fff;
      cursor: pointer;
      box-shadow: 0 2px 6px rgba(0,0,0,0.3);
    }
    #volume-slider::-moz-range-thumb {
      width: 16px;
      height: 16px;
      border-radius: 50%;
      background: #fff;
      cursor: pointer;
      border: none;
      box-shadow: 0 2px 6px rgba(0,0,0,0.3);
    }
    #volume-slider::-webkit-slider-track {
      background: rgba(255,255,255,0.2);
      border-radius: 4px;
      height: 8px;
    }
    #volume-slider::-moz-range-track {
      background: rgba(255,255,255,0.2);
      border-radius: 4px;
      height: 8px;
      border: none;
    }
    #music-window audio { display: none; }
    #profile-popup {
      position: fixed;
      display: none;
      flex-direction: column;
      align-items: center;
      min-width: 260px;
      background: rgba(20,20,20,0.30);
      border-radius: 18px;
      box-shadow: 0 8px 32px 0 rgba(0,0,0,0.25);
      padding: 32px 28px 24px 28px;
      z-index: 100;
      border: 1.5px solid rgba(255,255,255,0.12);
      opacity: 0;
      transform: scale(0.96) translate3d(0, 8px, 0);
      transition: opacity .18s cubic-bezier(.22,.61,.36,1), transform .18s cubic-bezier(.22,.61,.36,1);
      -webkit-backdrop-filter: blur(12px) saturate(120%);
      backdrop-filter: blur(12px) saturate(120%);
      will-change: transform, opacity;
      backface-visibility: hidden;
      contain: layout paint;
      bottom: 72px;
      left: 80px;
      right: auto;
    }
    #profile-popup.popup-visible { opacity: 1; transform: scale(1) translate3d(0, 0, 0); }
    @keyframes popupIn {
      0% { opacity: 0; transform: scale(0.8) translateY(40px);}
      100% { opacity: 1; transform: scale(1) translateY(0);}
    }
    #profile-popup .pfp {
      width: 72px;
      height: 72px;
      border-radius: 50%;
      margin-bottom: 12px;
      border: 2.5px solid #fff;
      box-shadow: 0 2px 12px 0 rgba(0,0,0,0.18);
      background: #222;
      object-fit: cover;
      filter: grayscale(1);
      transition: filter 0.3s;
    }
    #profile-popup .name {
      font-size: 20px;
      font-weight: 700;
      color: #fff;
      margin-bottom: 4px;
      text-align: center;
      letter-spacing: 0.03em;
      text-shadow: 0 2px 8px #000;
    }
    #profile-popup .status {
      font-size: 14px;
      color: #bbb;
      margin-bottom: 10px;
      text-align: center;
      min-height: 18px;
      letter-spacing: 0.02em;
      text-shadow: 0 1px 4px #000;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }
    #profile-popup .status-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      display: inline-block;
      margin-right: 4px;
      background: #bbb;
      box-shadow: 0 1px 4px 0 rgba(0,0,0,0.18);
      animation: statusPulse 1.2s infinite alternate cubic-bezier(.77,0,.18,1);
    }
    @keyframes statusPulse {
      0% { box-shadow: 0 0 0 0 rgba(255,255,255,0.12);}
      100% { box-shadow: 0 0 8px 4px rgba(255,255,255,0.18);}
    }
    #profile-popup .custom-text {
      font-size: 15px;
      color: #fff;
      margin-bottom: 16px;
      text-align: center;
      letter-spacing: 0.01em;
      min-height: 18px;
      opacity: 0.8;
    }
    .window-header span { 
      display: block; 
      flex: 1; 
      font-size: 14px; 
      font-weight: 400; 
      color: rgba(255,255,255,0.8); 
    }

    #panel {
      position: fixed;
      left: 8px; right: 8px; bottom: 8px;
      height: 44px;
      background: rgba(20,20,20,0.7);
      border: 1.5px solid rgba(255,255,255,0.08);
      border-radius: 12px;
      box-shadow: 0 -2px 16px 0 rgba(0,0,0,0.18);
      display: flex;
      align-items: center;
      justify-content: space-between;
      z-index: 20;
      padding: 0 24px;
      animation: panelIn 1.1s cubic-bezier(.77,0,.18,1);
      -webkit-backdrop-filter: blur(8px) saturate(120%);
      backdrop-filter: blur(8px) saturate(120%);
    }
    @keyframes panelIn {
      0% { opacity: 0; transform: translateY(48px);}
      100% { opacity: 1; transform: translateY(0);}
    }
    #panel .left {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    #panel .right {
      display: flex;
      align-items: center;
      gap: 18px;
    }
    #profile-pic {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      border: 2px solid #fff;
      object-fit: cover;
      background: #222;
      filter: grayscale(1);
      transition: filter 0.3s;
      cursor: pointer;
      box-shadow: 0 1px 6px 0 rgba(0,0,0,0.12);
    }
    #profile-pic:hover { filter: grayscale(1) brightness(1); }
    #profile-name {
      font-size: 16px;
      font-weight: 700;
      color: #fff;
      letter-spacing: 0.02em;
      text-shadow: 0 1px 4px #000;
      margin-right: 8px;
    }
    .clock { font-size: 16px; font-weight: 700; color: #fff; letter-spacing: 0.04em; text-shadow: 0 2px 8px #000; min-width: 80px; text-align: right; }

    @media (max-width: 700px) {
      #icons {
        left: 8px;
        top: 8px;
      }
      .icon { width: 60px; gap: 2px; }
      .icon img { width: 40px; height: 40px; }
      .icon span { font-size: 12px; }
      #panel {
        padding: 0 8px;
      }
      #tasks { max-width: 50vw; overflow-x: auto; }
      #profile-popup { right: 8px; left: 8px; min-width: unset; }
      .window { width: calc(100vw - 16px); max-height: calc(100vh - 100px); }
      #terminal-window { width: calc(100vw - 16px); }
      /* Make prev/next controls grayscale on mobile where they render as color emoji */
      #music-controls #prev,
      #music-controls #next { filter: grayscale(1); }
    }
  </style>
</head>
<body>
  <img id="wallpaper" src="./assets/wallpaper/DCA3UhDIVf.jpg">
  <div class="desktop">
    <div id="icons"></div>
    <template id="icon-template">
      <div class="icon">
        <img src="">
        <span></span>
      </div>
    </template>
    
    <div id="music-window" class="window" style="left: 600px; top: 120px; background: rgba(15,15,15,0.3);">
      <div class="window-header" id="music-drag">
        <span>mpv</span>
        <button class="close-btn" id="music-close">âœ•</button>
      </div>
      <div class="window-body">
      <div id="music-title"></div>
        <div id="music-controls">
          <button id="loop">âˆž</button>
        <button id="prev">&#9198;</button>
        <button id="play">&#9654;</button>
        <button id="next">&#9197;</button>
          <div id="volume-container">
            <button id="volume-btn">ðŸ”Š</button>
            <input type="range" id="volume-slider" min="0" max="100" value="100">
      </div>
        </div>
      <audio id="audio"></audio>
      </div>
    </div>
    <div id="notepad-window" class="window" style="left: 80px; top: 100px; background: rgba(15,15,15,0.3);">
      <div class="window-header" id="notepad-drag">
        <span>unsaved document 1</span>
        <button class="close-btn" id="notepad-close">âœ•</button>
      </div>
      <div class="window-body">
        <textarea id="notepad-text" placeholder=" "></textarea>
      </div>
    </div>
    <div id="bio-window" class="window" style="left: 280px; top: 180px; background: rgba(15,15,15,0.3);">
      <div class="window-header" id="bio-drag">
        <span>about me</span>
        <button class="close-btn" id="bio-close">âœ•</button>
      </div>
      <div class="window-body" id="bio-body" style="display:flex; flex-direction:column; align-items:center; gap:12px;">
        <img id="bio-pfp" src="" alt="pfp" style="width:88px; height:88px; border-radius:50%; border:2px solid rgba(255,255,255,0.9); object-fit:cover; filter:grayscale(1); box-shadow:0 2px 12px rgba(0,0,0,0.25);" />
        <div id="bio-name" style="font-weight:700; letter-spacing:0.03em; text-shadow:0 2px 8px #000;">Coyal</div>
        <div id="bio-custom" style="opacity:0.9; text-align:center; white-space:pre-line;">
        </div>
      </div>
    </div>
    <div id="terminal-window" class="window" style="left: 520px; top: 140px; background: rgba(15,15,15,0.3);">
      <div class="window-header" id="terminal-drag">
        <span>Coyal.lol:~</span>
        <button class="close-btn" id="terminal-close">âœ•</button>
      </div>
      <div class="window-body terminal-body">
        <div id="terminal-output" tabindex="0"></div>
      </div>
    </div>
    <div id="profile-popup">
      <img class="pfp" src="" alt="pfp">
      <div class="name"></div>
      <div class="status"></div>
      <div class="custom-text"></div>
    </div>
    <div id="panel">
      <div class="left">
        <div id="profile-group" style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
        <img id="profile-pic" src="https://cdn.discordapp.com/embed/avatars/0.png">
        <span id="profile-name">Coyal</span>
        </div>
      </div>
      <div class="tasks" id="tasks">
      </div>
      <div class="right">
        <span class="clock"></span>
      </div>
    </div>
  </div>
  <script>
    window.addEventListener('contextmenu', e => {
      e.preventDefault();
      window.open('https://www.google.com/search?q=get+your+money+up+lil+nga', '_blank');
    });
    const defaultProfilePic = "https://cdn.discordapp.com/embed/avatars/0.png";
    const defaultProfileName = "Coyal";
    const defaultWallpapers = [
      "./assets/wallpaper/DCA3UhDIVf.jpg"
    ];
    const defaultIcons = [
      { img: "./assets/icons/VAtuAVJFG3.png", label: "xed", type: "notepad" },
      { img: "./assets/icons/77Ai7oI52h.png", label: "kitty", type: "terminal" },
      { img: "./assets/icons/KU2GZgmQXz.png", label: "mpv", type: "music" },
      { img: defaultProfilePic, label: "bio", type: "bio", dynamic: true }
    ];
    function ensureTask(taskId, label, iconPath) {
      const bar = document.getElementById('tasks');
      let el = document.getElementById(taskId);
      if (!el) {
        el = document.createElement('button');
        el.id = taskId;
        el.className = 'task-icon';
        
        const iconImg = document.createElement('img');
        iconImg.src = iconPath;
        iconImg.style.width = '16px';
        iconImg.style.height = '16px';
        iconImg.style.filter = 'grayscale(1) contrast(1.2)';
        iconImg.style.borderRadius = '4px';
        
        const labelText = document.createElement('span');
        labelText.textContent = label;
        
        el.innerHTML = '';
        el.appendChild(iconImg);
        el.appendChild(labelText);
        el.style.display = 'inline-flex';
        bar.appendChild(el);
        requestAnimationFrame(() => el.classList.add('visible'));
      } else {
        el.style.display = 'inline-flex';
        requestAnimationFrame(() => el.classList.add('visible'));
      }
      return el;
    }
    function hideTask(taskId) {
      const el = document.getElementById(taskId);
      if (!el) return;
      el.classList.remove('visible');
      setTimeout(() => { if (document.getElementById(taskId) === el) el.style.display = 'none'; }, 180);
    }
    const defaultMusic = [
      { title: "Don't hide - So Supa", src: "./assets/music/ItSkYnUOEZ.mp3" },
      { title: "Yeat On Tha Line", src: "./assets/music/bg7ex7C139.mp3" },
      { title: "backstage ft zayguapkid & bloody (dmtnas)", src: "./assets/music/KUkwNMqzr8.mp3" },
      { title: "Playboi Carti - 24 SONGS", src: "./assets/music/hzELfh0PxG.mp3" },
      { title: "Stupid Shit (A.T. mixxx)", src: "./assets/music/OGm2ETtWK6.mp3" }
    ];
    let musicList = [...defaultMusic];
    let currentTrack = 0;
    let isPlaying = false;
    let iconList = [...defaultIcons];
    let lanyardId = "1455509732885397587";
    let customText = "";
    function setWallpaper(src) {
      document.getElementById('wallpaper').src = src;
      localStorage.setItem('desktop_wallpaper', src);
    }
    function setProfilePic(src) {
      document.getElementById('profile-pic').src = src;
      localStorage.setItem('desktop_profile_pic', src);
    }
    function setProfileName(name) {
      document.getElementById('profile-name').textContent = name;
      localStorage.setItem('desktop_profile_name', name);
    }
    function renderIcons() {
      const iconsDiv = document.getElementById('icons');
      iconsDiv.innerHTML = '';
      iconList.forEach(icon => {
        if (icon.dynamic) {
          icon.img = document.getElementById('profile-pic').src || defaultProfilePic;
        }
        const node = document.getElementById('icon-template').content.cloneNode(true);
        const img = node.querySelector('img');
        const span = node.querySelector('span');
        img.src = icon.img;
        span.textContent = icon.label;
        const wrap = node.querySelector('.icon');
        if (icon.type === 'notepad') wrap.onclick = toggleNotepad;
        else if (icon.type === 'terminal') wrap.onclick = toggleTerminal;
        else if (icon.type === 'music') wrap.onclick = toggleMusicPlayer;
        else if (icon.type === 'bio') wrap.onclick = toggleBio;
        iconsDiv.appendChild(node);
      });
      localStorage.setItem('desktop_icons', JSON.stringify(iconList));
    }
    function loadFromStorage() {
      setWallpaper(localStorage.getItem('desktop_wallpaper') || defaultWallpapers[0]);
      setProfilePic(localStorage.getItem('desktop_profile_pic') || defaultProfilePic);
      setProfileName(localStorage.getItem('desktop_profile_name') || defaultProfileName);
      iconList = [...defaultIcons];
      lanyardId = localStorage.getItem('lanyard_id') || lanyardId;
      customText = localStorage.getItem('custom_text') || "";
      renderIcons();
      fetchLanyard();
    }

    let audioVolume = 1, isMuted = false, previousVolume = 1, isLooping = false;

    function playMusic(idx) {
      currentTrack = idx;
      const audio = document.getElementById('audio');
      audio.src = musicList[currentTrack].src;
      document.getElementById('music-title').textContent = musicList[currentTrack].title;
      
      isPlaying = false;
      document.getElementById('play').innerHTML = '&#9654;';
    }

    function togglePlay() {
      const audio = document.getElementById('audio');
      if (!isPlaying) {
        audio.play().then(() => {
          isPlaying = true;
          document.getElementById('play').innerHTML = '&#10073;&#10073;';
        }).catch(error => {
          console.warn('audio playback failed:', error);
          isPlaying = false;
          document.getElementById('play').innerHTML = '&#9654;';
        });
      } else {
        audio.pause();
        isPlaying = false;
        document.getElementById('play').innerHTML = '&#9654;';
      }
    }

    function prevTrack() {
      currentTrack = (currentTrack - 1 + musicList.length) % musicList.length;
      playMusic(currentTrack);
    }

    function nextTrack() {
      currentTrack = (currentTrack + 1) % musicList.length;
      playMusic(currentTrack);
    }

    function toggleMute() {
      const audio = document.getElementById('audio');
      const volumeBtn = document.getElementById('volume-btn');
      const volumeSlider = document.getElementById('volume-slider');
      
      if (isMuted) {
        audio.volume = previousVolume;
        volumeSlider.value = previousVolume * 100;
        volumeBtn.textContent = previousVolume > 0.5 ? 'ðŸ”Š' : previousVolume > 0 ? 'ðŸ”‰' : 'ðŸ”ˆ';
        isMuted = false;
      } else {
        previousVolume = audio.volume;
        audio.volume = 0;
        volumeSlider.value = 0;
        volumeBtn.textContent = 'ðŸ”‡';
        isMuted = true;
      }
    }

    function toggleLoop() {
      const loopBtn = document.getElementById('loop');
      isLooping = !isLooping;
      
      if (isLooping) {
        loopBtn.textContent = 'âˆž';
        loopBtn.style.color = '#4CAF50';
      } else {
        loopBtn.textContent = 'âˆž';
        loopBtn.style.color = '#fff';
      }
    }

    function updateVolume(value) {
      const audio = document.getElementById('audio');
      const volumeBtn = document.getElementById('volume-btn');
      
      audioVolume = value / 100;
      audio.volume = audioVolume;
      isMuted = audioVolume === 0;
      
      volumeBtn.textContent = audioVolume === 0 ? 'ðŸ”‡' : 
                             audioVolume > 0.5 ? 'ðŸ”Š' : 
                             audioVolume > 0 ? 'ðŸ”‰' : 'ðŸ”ˆ';
    }


    document.getElementById('audio').onended = () => {
      if (isLooping) {
        const audio = document.getElementById('audio');
        audio.currentTime = 0;
        audio.play().catch(error => {
          console.warn('audio playback failed:', error);
        });
      } else {
        nextTrack();
      }
    };

    document.getElementById('audio').onpause = () => {
      isPlaying = false;
      document.getElementById('play').innerHTML = '&#9654;';
    };

    document.getElementById('audio').onplay = () => {
      isPlaying = true;
      document.getElementById('play').innerHTML = '&#10073;&#10073;';
    };
    function toggleMusicPlayer() {
      const win = document.getElementById('music-window');
      if (!win) return;
      
      const isOpen = win.style.display === 'block';
      
      if (isOpen) {
        win.classList.remove('visible');
        setTimeout(() => { win.style.display = 'none'; }, 180);
        hideTask('task-mpv');
      const audio = document.getElementById('audio');
        if (audio) {
          audio.pause();
          isPlaying = false;
          const playBtn = document.getElementById('play');
          if (playBtn) playBtn.innerHTML = '&#9654;';
        }
      } else {
        win.style.display = 'block';
        centerElement(win);
        requestAnimationFrame(() => win.classList.add('visible'));
        const task = ensureTask('task-mpv', 'mpv', './assets/icons/KU2GZgmQXz.png');
        task.onclick = toggleMusicPlayer;
        playMusic(currentTrack);
      }
    }
    function makeDraggable(handleEl, moveEl) {
      let dragging = false;
      let startX = 0, startY = 0;
      let startLeft = 0, startTop = 0;
      const startDrag = (cx, cy) => {
        dragging = true;
        const rect = moveEl.getBoundingClientRect();
        startX = cx;
        startY = cy;
        startLeft = rect.left;
        startTop = rect.top;
        moveEl.style.left = rect.left + 'px';
        moveEl.style.top = rect.top + 'px';
        moveEl.style.right = 'auto';
        moveEl.style.bottom = 'auto';
        document.body.style.cursor = 'grabbing';
      };
      const moveDrag = (cx, cy) => {
        if (!dragging) return;
        const dx = cx - startX;
        const dy = cy - startY;
        moveEl.style.left = startLeft + dx + 'px';
        moveEl.style.top = startTop + dy + 'px';
      };
      const endDrag = () => {
        dragging = false;
        document.body.style.cursor = '';
      };

      handleEl.addEventListener('mousedown', e => {
        dragging = true;
        const rect = moveEl.getBoundingClientRect();
        startX = e.clientX;
        startY = e.clientY;
        startLeft = rect.left;
        startTop = rect.top;
        moveEl.style.left = rect.left + 'px';
        moveEl.style.top = rect.top + 'px';
        moveEl.style.right = 'auto';
        moveEl.style.bottom = 'auto';
        document.body.style.cursor = 'grabbing';
      });
      window.addEventListener('mousemove', e => {
        moveDrag(e.clientX, e.clientY);
      });
      window.addEventListener('mouseup', endDrag);

      handleEl.addEventListener('touchstart', e => {
        const t = e.touches[0];
        startDrag(t.clientX, t.clientY);
      }, { passive: true });
      window.addEventListener('touchmove', e => {
        const t = e.touches[0];
        if (!t) return;
        moveDrag(t.clientX, t.clientY);
      }, { passive: true });
      window.addEventListener('touchend', endDrag);
    }
    function centerElement(el) {
      el.style.right = 'auto';
      el.style.bottom = 'auto';
      const rect = el.getBoundingClientRect();
      const left = Math.max(8, Math.round((window.innerWidth - rect.width) / 2));
      const top = Math.max(8, Math.round((window.innerHeight - rect.height) / 2));
      el.style.left = left + 'px';
      el.style.top = top + 'px';
    }
    function toggleNotepad() {
      const win = document.getElementById('notepad-window');
      const isOpen = win.style.display === 'block';
      if (isOpen) {
        win.classList.remove('visible');
        setTimeout(() => { win.style.display = 'none'; }, 180);
        hideTask('task-xed');
      } else {
        win.style.display = 'block';
        centerElement(win);
        requestAnimationFrame(() => win.classList.add('visible'));
        const task = ensureTask('task-xed', 'xed', './assets/icons/VAtuAVJFG3.png');
        task.onclick = toggleNotepad;
      }
    }
    function toggleBio() {
      const win = document.getElementById('bio-window');
      const isOpen = win.style.display === 'block';
      if (isOpen) {
        win.classList.remove('visible');
        setTimeout(() => { win.style.display = 'none'; }, 180);
        hideTask('task-bio');
      } else {
        updateBioContent();
        win.style.display = 'block';
        centerElement(win);
        requestAnimationFrame(() => win.classList.add('visible'));
        const task = ensureTask('task-bio', 'bio', document.getElementById('profile-pic').src || defaultProfilePic);
        task.onclick = toggleBio;
      }
    }
    function toggleTerminal() {
      const win = document.getElementById('terminal-window');
      const wasOpen = win.style.display === 'block';
      if (wasOpen) {
        win.classList.remove('visible');
        setTimeout(() => { win.style.display = 'none'; }, 180);
        hideTask('task-kitty');
      } else {
        win.style.display = 'block';
        centerElement(win);
        const out = document.getElementById('terminal-output');
        out.focus();
        requestAnimationFrame(() => win.classList.add('visible'));
        const task = ensureTask('task-kitty', 'kitty', './assets/icons/77Ai7oI52h.png');
        task.onclick = toggleTerminal;
      }
    }
    function bringToFront(element) {
      const windows = document.querySelectorAll('.window');
      windows.forEach(win => {
        if (win !== element) {
          win.style.zIndex = '18';
        }
      });
      element.style.zIndex = '19';
    }

    function handleWindowClick(event) {
      const windowElement = event.currentTarget;
      bringToFront(windowElement);
    }

    document.addEventListener('DOMContentLoaded', () => {
      makeDraggable(document.getElementById('notepad-drag'), document.getElementById('notepad-window'));
      makeDraggable(document.getElementById('terminal-drag'), document.getElementById('terminal-window'));
      makeDraggable(document.getElementById('music-drag'), document.getElementById('music-window'));
      makeDraggable(document.getElementById('bio-drag'), document.getElementById('bio-window'));
      
      document.querySelectorAll('.window').forEach(window => {
        window.addEventListener('mousedown', handleWindowClick);
      });
      
      document.getElementById('notepad-close').onclick = toggleNotepad;
      document.getElementById('terminal-close').onclick = toggleTerminal;
      document.getElementById('music-close').onclick = toggleMusicPlayer;
      document.getElementById('bio-close').onclick = toggleBio;
      
      document.getElementById('loop').onclick = toggleLoop;
      document.getElementById('play').onclick = togglePlay;
      document.getElementById('prev').onclick = prevTrack;
      document.getElementById('next').onclick = nextTrack;
      document.getElementById('volume-btn').onclick = toggleMute;
      document.getElementById('volume-slider').oninput = (e) => updateVolume(e.target.value);
      

      const out = document.getElementById('terminal-output');
      const promptStr = 'ã‚¹  ~ ';
      let currentInput = '';
      let acceptingInput = true;
      function escapeHtml(str) {
        return str.replace(/[&<>\"]/g, s => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[s]));
      }
      function appendLine(html) {
        const d = document.createElement('div');
        d.innerHTML = html;
        out.appendChild(d);
      }
      function renderPrompt() {
        const line = document.createElement('div');
        const inputSpan = document.createElement('span');
        inputSpan.id = 'terminal-current-input';
        inputSpan.textContent = currentInput;
        line.innerHTML = escapeHtml(promptStr);
        line.appendChild(inputSpan);
        out.appendChild(line);
        out.scrollTop = out.scrollHeight;
      }
      function resetTerminal() {
        currentInput = '';
        out.innerHTML = '';
        renderPrompt();
      }
      resetTerminal();
      out.addEventListener('keydown', e => {
        if (!acceptingInput) { e.preventDefault(); return; }
        if (e.key === 'Backspace') {
          e.preventDefault();
          currentInput = currentInput.slice(0, -1);
          const span = document.getElementById('terminal-current-input');
          if (span) span.textContent = currentInput;
          return;
        }
        if (e.key === 'Enter') {
          e.preventDefault();
          const value = currentInput.trim();
          if (value) {
            if (value.toLowerCase() === 'magic') appendLine('the pibble army is watching you');
            else if (value.toLowerCase() === 'clear') {
              resetTerminal();
              return;
            }

            else appendLine('error');
          }
          currentInput = '';
          renderPrompt();
          const prompts = out.querySelectorAll('#terminal-current-input');
          prompts.forEach((sp, idx) => { if (idx !== prompts.length - 1) sp.removeAttribute('id'); });
          return;
        }
        if (e.key.length === 1 && !e.ctrlKey && !e.metaKey && !e.altKey) {
          currentInput += e.key;
          const span = document.getElementById('terminal-current-input');
          if (span) span.textContent = currentInput;
        }
      });
    });

    function updateClock() {
      const now = new Date();
      const optionsTime = { timeZone: 'America/New_York', hour: 'numeric', minute: '2-digit', hour12: true };
      const timeStr = new Intl.DateTimeFormat('en-US', optionsTime).format(now);
      document.querySelector('.clock').textContent = timeStr.toLowerCase();
    }
    setInterval(updateClock, 1000);
    updateClock();
    function showProfilePopup() {
      const popup = document.getElementById('profile-popup');
      const groupRect = document.getElementById('profile-group').getBoundingClientRect();
      popup.style.display = 'flex';
      if (window.innerWidth >= 701) {
        popup.style.left = Math.max(8, groupRect.left - 12) + 'px';
        popup.style.right = 'auto';
      } else {
        popup.style.left = '8px';
        popup.style.right = '8px';
      }
      popup.style.bottom = '72px';
      void popup.offsetHeight;
      popup.classList.add('popup-visible');
    }
    function hideProfilePopup() {
      const popup = document.getElementById('profile-popup');
      if (!popup.classList.contains('popup-visible')) {
        popup.style.display = 'none';
        return;
      }
      const onDone = () => {
        popup.removeEventListener('transitionend', onDone);
        if (!popup.classList.contains('popup-visible')) popup.style.display = 'none';
      };
      popup.addEventListener('transitionend', onDone);
      popup.classList.remove('popup-visible');
    }
    document.getElementById('profile-group').onclick = () => {
      const popup = document.getElementById('profile-popup');
      if (popup.style.display === 'flex') {
        hideProfilePopup();
      } else {
        showProfilePopup();
      }
    };
    document.body.addEventListener('mousedown', function(e) {
      const popup = document.getElementById('profile-popup');
      const profileGroup = document.getElementById('profile-group');
      if (popup.style.display === 'flex' && !popup.contains(e.target) && !profileGroup.contains(e.target)) {
        hideProfilePopup();
      }
    });
    function fetchLanyard() {
      const popup = document.getElementById('profile-popup');
      const pfp = popup.querySelector('.pfp');
      const name = popup.querySelector('.name');
      const status = popup.querySelector('.status');
      const ctext = popup.querySelector('.custom-text');
      const panelPfp = document.getElementById('profile-pic');
      const panelName = document.getElementById('profile-name');
      pfp.src = "";
      name.textContent = "";
      status.innerHTML = "";
      ctext.textContent = customText || "Mogged";
      if (!lanyardId) return;
      fetch(`https://api.lanyard.rest/v1/users/${lanyardId}`)
        .then(r => r.json())
        .then(data => {
          if (data && data.success && data.data) {
            const d = data.data;
            const avatarUrl = d.discord_user.avatar
              ? `https://cdn.discordapp.com/avatars/${d.discord_user.id}/${d.discord_user.avatar}.png?size=128`
              : `https://cdn.discordapp.com/embed/avatars/0.png`;
            pfp.src = avatarUrl;
            panelPfp.src = avatarUrl;
            name.textContent = 'Coyal';
            panelName.textContent = 'Coyal';
            const st = d.discord_status;
            const dot = document.createElement('span');
            dot.className = "status-dot";
            dot.style.background = {
              'online': '#fff',
              'idle': '#bbb', 
              'dnd': '#888'
            }[st] || '#444';
            status.appendChild(dot);
            status.append(st.charAt(0).toUpperCase() + st.slice(1));
            updateBioContent();
            renderIcons();
          }
        });
    }

    function updateBioContent() {
      const bioPfp = document.getElementById('bio-pfp');
      const bioName = document.getElementById('bio-name');
      const bioCustom = document.getElementById('bio-custom');
      if (!bioPfp || !bioName) return;
      const currentPfp = document.getElementById('profile-pic').src || defaultProfilePic;
      const currentName = document.getElementById('profile-name').textContent || defaultProfileName;
      bioPfp.src = currentPfp;
      bioName.textContent = currentName;
      const bioText = `A Real Nigga that Money Mogs You`;
      bioCustom.textContent = bioText;
    }

    window.addEventListener('resize', () => {
      document.querySelectorAll('.window').forEach(win => {
        const rect = win.getBoundingClientRect();
        let left = rect.left;
        let top = rect.top;
        const maxLeft = window.innerWidth - rect.width - 8;
        const maxTop = window.innerHeight - rect.height - 8;
        if (left > maxLeft) left = Math.max(8, maxLeft);
        if (top > maxTop) top = Math.max(8, maxTop);
        if (left < 8) left = 8;
        if (top < 8) top = 8;
        win.style.left = left + 'px';
        win.style.top = top + 'px';
      });
    });



    loadFromStorage();
    playMusic(0);
  </script>
</body>
</html>
